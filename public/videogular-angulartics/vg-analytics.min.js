"use strict";angular.module("com.2fdevs.videogular.plugins.analytics",["angulartics"]).directive("vgAnalytics",["$analytics","VG_STATES",function(a,b){return{restrict:"E",require:"^videogular",scope:{vgTrackInfo:"=?"},link:function(c,d,e,f){var g=null,h=null,i=null,j=[];c.API=f,c.trackEvent=function(b){a.eventTrack(b,g)},c.onPlayerReady=function(a){a&&c.trackEvent("ready")},c.onChangeState=function(a){switch(h=a,a){case b.PLAY:c.vgTrackInfo.events.play&&c.trackEvent("play");break;case b.PAUSE:c.vgTrackInfo.events.pause&&c.trackEvent("pause");break;case b.STOP:c.vgTrackInfo.events.stop&&c.trackEvent("stop")}},c.onCompleteVideo=function(a){a&&c.trackEvent("complete")},c.onUpdateTime=function(a){j.length>0&&a>=j[0].jump&&(c.trackEvent("progress "+j[0].percent+"%"),j.shift())},c.updateTrackInfo=function(a){c.vgTrackInfo.category&&(g.category=c.vgTrackInfo.category),c.vgTrackInfo.label&&(g.label=c.vgTrackInfo.label)},c.addWatchers=function(){if((c.vgTrackInfo.category||c.vgTrackInfo.label)&&(g={},c.updateTrackInfo(c.vgTrackInfo)),c.$watch("vgTrackInfo",c.updateTrackInfo,!0),c.vgTrackInfo.events.ready&&c.$watch(function(){return f.isReady},function(a,b){c.onPlayerReady(a)}),(c.vgTrackInfo.events.play||c.vgTrackInfo.events.pause||c.vgTrackInfo.events.stop)&&c.$watch(function(){return f.currentState},function(a,b){a!=b&&c.onChangeState(a)}),c.vgTrackInfo.events.complete&&c.$watch(function(){return f.isCompleted},function(a,b){c.onCompleteVideo(a)}),c.vgTrackInfo.events.progress){c.$watch(function(){return f.currentTime},function(a,b){c.onUpdateTime(a/1e3)});var a=c.$watch(function(){return f.totalTime},function(b,d){if(i=b/1e3,i>0){for(var e=c.vgTrackInfo.events.progress-1,f=Math.floor(i/c.vgTrackInfo.events.progress),g=0;e>g;g++)j.push({percent:(g+1)*c.vgTrackInfo.events.progress,jump:(g+1)*f});a()}})}},f.isConfig?c.$watch("API.config",function(){c.API.config&&(c.vgTrackInfo=c.API.config.plugins.analytics,c.addWatchers())}):c.addWatchers()}}}]);